@import "~scss/_vars";
@mixin cnt-2 { width: calc(536px / 2); }
@mixin cnt-3 { width: calc(532px / 3); }
@mixin cnt-4 { width: calc(528px / 4); }

.blocks {
	.block.blockChat { @include text-common; }
	.block.blockChat { 
		.wrap.isDraggingOver { opacity: 0.5; cursor: copy; }

		.scrollWrapper { display: flex; flex-direction: column; min-height: 206px; }
		.scrollWrapper {
			.scroll { min-height: 100%; display: flex; flex-direction: column; justify-content: flex-end; }
		}

		.emptyState { display: flex; flex-direction: column; gap: 16px 0px; align-items: center; justify-content: center; flex-grow: 1; text-align: center; }
		.emptyState {
			.img { width: 320px; height: 104px; display: flex; align-items: center; justify-content: center; background: radial-gradient(50% 50% at 50% 50%, #80d1ff 0%, rgba(187, 231, 255, 0.00) 100%); }
			.icon { width: 108px; height: 88px; background: url('~img/icon/chat/emptyState.svg'); }
			.label { @include text-common; color: var(--color-text-secondary); }
		}

		.attachments { padding: 8px 0px 0px 0px; display: flex; gap: 8px; flex-wrap: wrap; max-width: 540px; }
		.attachments {
			.attachment { 
				position: relative; border: 1px solid var(--color-shape-tertiary); background: var(--color-bg-primary); box-shadow: 0px 0px 4px rgba(0,0,0,0.05);
				width: calc(532px / 2); height: 72px; border-radius: 8px; display: flex; flex-direction: row; align-items: center;;
			}

			.attachment {
				.clickable { display: flex; flex-direction: row; gap: 0px 12px; align-items: center; padding: 11px; width: 100%; }
				.iconObject { flex-shrink: 0; background-color: var(--color-shape-tertiary); border-radius: 6px; }
				.info { flex-grow: 1; width: 100%; }

				.icon.remove { 
					opacity: 0; transition: $transitionAllCommon; position: absolute; right: -6px; top: -6px; width: 20px; height: 20px; background-size: 8px; 
					background-image: url('~img/icon/chat/buttons/remove.svg'); background-color: var(--color-bg-primary); border-radius: 50%;
					box-shadow: 0px 1px 4px rgba(0,0,0,0.2);
				}

				.name { line-height: 20px; font-weight: 500; @include clamp1; }
				.descr { @include text-small; @include clamp1; }
				.descr {
					.bullet { width: 2px; height: 2px; border-radius: 50%; background: var(--color-text-secondary); }
				}
			}

			.attachment.isFile, .attachment.isBookmark {
				.iconObject { background-color: unset; }
				.descr { display: flex; flex-direction: row; gap: 0px 6px; align-items: center; color: var(--color-text-secondary); }
			}

			.attachment.isBookmark {
				.url { @include text-overflow-nw; }
				.info { display: flex; flex-direction: column; gap: 2px 0px; }
			}

			.attachment.isImage { width: 72px; display: flex; align-items: center; justify-content: center; }
			.attachment.isImage {
				.image { display: block; object-fit: cover; aspect-ratio: 1; max-width: 100%; height: 100%; border-radius: 8px; }
			}

			.attachment:hover {
				.icon.remove { opacity: 1; }
			}
		}

		.attachments.isSingle {
			.attachment { width: 100%; }
		}

		/* Layouts */

		.attachments.withLayout { gap: 4px; }
		.attachments.withLayout {
			.attachment.isImage { border-radius: 12px; height: auto; width: auto; aspect-ratio: 1; flex-shrink: 0; }
		}

		.attachments.layout-1 { max-width: 360px; }
		.attachments.layout-1 {
			.attachment.isImage { max-width: 360px; max-height: 360px; aspect-ratio: unset; }
			.attachment.isImage {
				.image { aspect-ratio: unset; }
			}
		}
		.attachments.layout-2 { gap: 4px; }
		.attachments.layout-2 {
			.attachment.isImage { @include cnt-2; }
		}
		.attachments.layout-3 {
			.attachment.isImage { @include cnt-3; }
		}
		.attachments.layout-4 {
			.attachment.isImage { @include cnt-4; }
		}
		.attachments.layout-5 {
			.attachment.isImage { @include cnt-3; }
			.attachment.isImage:nth-child(-n + 2) { @include cnt-2; }
		}
		.attachments.layout-6 {
			.attachment.isImage { @include cnt-3; }
		}
		.attachments.layout-7 {
			.attachment.isImage { @include cnt-4; }
			.attachment.isImage:nth-child(-n + 3) { @include cnt-3; }
		}
		.attachments.layout-8 {
			.attachment.isImage { @include cnt-4; }
		}
		.attachments.layout-9 {
			.attachment.isImage { @include cnt-3; }
		}
		.attachments.layout-10 {
			.attachment.isImage { @include cnt-4; }
			.attachment.isImage:nth-child(-n + 6) { @include cnt-3; }
		}

		.section { display: flex; flex-direction: column; gap: 4px 0px; padding: 16px 0px; }
		.section:first-child { padding-top: 0px; }
		.section {
			> .date { position: sticky; display: flex; justify-content: center; top: 60px; z-index: 10; pointer-events: none; transition: opacity 0.3s $easeInQuint; }
			> .date {
				.label { @include text-small; padding: 3px 10px; background: var(--color-bg-primary); border: 1px solid var(--color-shape-tertiary); border-radius: 13px; }
			}
			> .date.hide { opacity: 0; }
		}

		.message { @include text-common; position: relative; }
		.message {
			.text { user-select: text !important; }
			.label.small { display: inline-block; @include text-small; color: var(--color-text-secondary); margin: 0px 0px 0px 4px; }
			.flex { display: flex; flex-direction: row; gap: 0px 8px; align-items: stretch; }

			.side.left { flex-shrink: 0; width: 40px; display: flex; align-items: flex-end; }
			.side.left {
				.iconObject { display: none; }
			}

			.side.right { display: flex; flex-direction: column; padding: 12px 16px; border-radius: 20px; background: rgba(242, 242, 242, 0.5); position: relative; }

			.controls { flex-shrink: 0; display: flex; flex-direction: row; align-items: center; justify-content: flex-start; gap: 0px 8px; opacity: 0; transition: opacity $transitionCommon; }
			.controls {
				.icon { width: 20px; height: 20px; }
				.icon.reactionAdd { background-image: url('~img/icon/chat/buttons/reaction0.svg'); }
				.icon.messageReply { background-image: url('~img/icon/chat/buttons/reply0.svg'); }
				.icon.more { background-image: url('~img/icon/menu/action/more0.svg'); }

				.icon.reactionAdd:hover, .icon.reactionAdd.hover { background-image: url('~img/icon/chat/buttons/reaction1.svg'); }
				.icon.messageReply:hover, .icon.messageReply.hover { background-image: url('~img/icon/chat/buttons/reply1.svg'); }
				.icon.more:hover, .icon.more.hover { background-image: url('~img/icon/menu/action/more1.svg'); }
			}

			.attachments {
				.attachment {
					.icon.remove { display: none; }
				}
			}

			.author { display: none; align-items: center; gap: 0px 8px; }
			.author {
				.name { font-weight: 500; }
				.time { @include text-small; color: var(--color-text-secondary); }
			}

			.expand { display: none; align-items: center; gap: 0px 8px; @include text-small; font-weight: 500; color: var(--color-text-secondary); margin-top: 4px; }
			.expand::after { content: ''; display: block; width: 8px; height: 8px; background: url('~img/arrow/button/grey.svg'); }

			.sub { @include text-small; color: var(--color-text-secondary); display: none; }
			.sub {
				.item:hover { color: var(--color-text-primary); }
			}

			.reactions { padding: 12px 0px 0px 0px; display: flex; flex-wrap: wrap; flex-direction: row; gap: 8px; }
			.reactions {
				.reaction { 
					display: flex; flex-direction: row; border-radius: 14px; gap: 0px 4px; align-items: center; @include text-small; font-weight: 500; 
					background-color: var(--color-shape-highlight-medium); padding: 4px 6px; flex-shrink: 0;
				}
				.reaction:hover { background-color: var(--color-shape-highlight-dark); }
				.reaction {
					.count { min-width: 18px; text-align: center; }
				}

				.reaction.isSelf { box-shadow: 0px 0px 0px 1px inset var(--color-system-accent-125); background-color: var(--color-system-accent-25); }
			}

			.newMessages { display: none; justify-content: center; position: absolute; bottom: -9px; left: 0px;  width: 100%; }
			.newMessages {
				.label { @include text-small; padding: 0px 12px; font-weight: 500; background: var(--color-bg-primary); color: var(--color-text-secondary); }
			}
		}
		.message.isSelf {
			.flex { flex-direction: row-reverse; }
			.side.right { background: rgba(229, 248, 214, 0.5); }
			.controls { flex-direction: row-reverse; }
			#message-reply { display: none; }
		}

		.message.canExpand {
			.expand { display: flex; }
			.text { @include clamp; -webkit-line-clamp: 10; }
		}
		.message.canExpand.isExpanded {
			.text { -webkit-line-clamp: unset; }
		}
		.message:hover, .message.hover {
			.controls { opacity: 1; }
		}

		.message:first-child { margin-top: 0px; }

		.message.isFirst { margin: 12px 0px 0px 0px; }
		.message.isFirst {
			.author { display: flex; }
			.side.right {  min-width: 164px; }
		}

		.message.isLast {
			.side.left {
				.iconObject { display: block; }
			}
		}

		.message.isNew:not(:last-child) { position: relative; padding-bottom: 25px; margin-bottom: 6px; border-bottom: 1px solid var(--color-shape-tertiary); }
		.message.isNew {
			.newMessages { display: flex; }
		}
		.message.isNew:last-child {
			.newMessages { display: none; }
		}

		.formWrapper.isFixed { padding: 0px 0px 90px 0px; position: sticky; z-index: 2; bottom: 0px; width: 100%; background: var(--color-bg-primary); }

		.form { 
			padding: 0px 0px 10px 0px; border: 1px solid var(--color-shape-tertiary); background-color: var(--color-bg-primary); border-radius: 12px; position: relative; 
			overflow: hidden; 
		}
		.form {
			#form-loader { display: none; position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; background: rgba(255,255,255,0.75); z-index: 1; }
			#form-loader.active { display: block; }

			.head { 
				padding: 12px 12px 12px 16px; display: flex; flex-direction: row; gap: 0px 16px; align-items: center; justify-content: space-between; 
				background: var(--color-shape-tertiary);
			}
			.head {
				.side.left { flex-grow: 1; @include text-small; display: flex; flex-direction: column; overflow: hidden; }
				.side.right { flex-shrink: 0; }

				.name { @include text-overflow-nw; font-weight: 500; }
				.descr { @include text-overflow-nw; }
				.descr:empty { display: none; }
				.icon.clear { width: 20px; height: 20px; background-image: url('~img/icon/chat/buttons/clear.svg'); }
			}

			.editableWrap { @include text-common; max-height: 352px; overflow: scroll; background-color: transparent; }
			.editableWrap {
				.editable, .placeholder { padding: 16px; }
			}

			.attachments { padding: 0px 16px; max-height: 360px; overflow-x: hidden; overflow-y: auto; }

			.buttons { display: flex; gap: 0px 8px; padding: 10px 16px 0px 16px; margin-left: -4px; }
			.buttons {
				.icon { width: 28px; height: 28px; background-size: 20px 20px; margin: 0px; border-radius: 6px; transition: none; }
				.icon:hover { background-color: var(--color-shape-highlight-medium); }

				/* Chat buttons */
				.icon.plus { background-image: url('~img/icon/chat/buttons/plus.svg'); }
				.icon.text { background-image: url('~img/icon/chat/buttons/text.svg'); }
				.icon.emoji { background-image: url('~img/icon/chat/buttons/emoji.svg'); }
				.icon.mention { background-image: url('~img/icon/chat/buttons/mention.svg'); }

				/* Text buttons */
				.icon.bold { background-image: url('~img/icon/menu/action/mark/bold0.svg'); }
				.icon.italic { background-image: url('~img/icon/menu/action/mark/italic0.svg'); }
				.icon.strike { background-image: url('~img/icon/menu/action/mark/strike0.svg'); }
				.icon.link { background-image: url('~img/icon/menu/action/mark/link0.svg'); }
				.icon.kbd { background-image: url('~img/icon/menu/action/mark/code0.svg'); }
				.icon.underline { background-image: url('~img/icon/menu/action/mark/underline0.svg'); }

				.icon.isActive.bold { background-image: url('~img/icon/menu/action/mark/bold1.svg'); }
				.icon.isActive.kbd { background-image: url('~img/icon/menu/action/mark/code1.svg'); }
				.icon.isActive.italic { background-image: url('~img/icon/menu/action/mark/italic1.svg'); }
				.icon.isActive.link { background-image: url('~img/icon/menu/action/mark/link1.svg'); }
				.icon.isActive.strike { background-image: url('~img/icon/menu/action/mark/strike1.svg'); }
				.icon.isActive.underline { background-image: url('~img/icon/menu/action/mark/underline1.svg'); }

				.icon.color { z-index: 1; }
				.icon.color {
					.inner { 
						width: 16px; height: 16px; position: absolute; left: 50%; top: 50%; margin: -8px 0px 0px -8px; border-radius: 100%;
						background: var(--color-text-primary); 
					}
					.inner.bgColor-default { box-shadow: 0px 0px 0px 1px var(--color-shape-secondary) inset; background: var(--color-bg-primary); }
					
					.inner.textColor-black { background: var(--color-text-primary); }
					.inner.textColor-grey { background: var(--color-control-active); }
					.inner.textColor-yellow { background: var(--color-yellow); }
					.inner.textColor-orange { background: var(--color-orange); }
					.inner.textColor-red { background: var(--color-red); }
					.inner.textColor-pink { background: var(--color-pink); }
					.inner.textColor-purple { background: var(--color-purple); }
					.inner.textColor-blue { background: var(--color-blue); }
					.inner.textColor-ice { background: var(--color-ice); }
					.inner.textColor-teal { background: var(--color-teal); }
					.inner.textColor-lime { background: var(--color-lime); }
				}
			}

			.icon.send { position: absolute; bottom: 10px; right: 16px; width: 20px; height: 20px; background: url('~img/icon/chat/buttons/send.svg'); }
		}
	}
}
